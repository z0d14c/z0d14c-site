---
import { Image } from 'astro:assets';
import type { ImageMetadata } from 'astro:assets';
import '@splidejs/splide/css';

interface Props {
  images: ImageMetadata[];
}

const { images } = Astro.props;
const id = `splide-${Math.random().toString(36).slice(2, 9)}`;
---

<div id={id} class='splide'>
  <div class='splide__track'>
    <ul class='splide__list'>
      {images.map((img) => (
        <li class='splide__slide'>
          <Image
            src={img}
            alt=''
            width={img.width}
            height={img.height}
            class='rounded border-2 border-black max-w-full h-auto max-h-96 object-contain mx-auto'
          />
        </li>
      ))}
    </ul>
  </div>
</div>

<script define:vars={{ id }}>
  import Splide from '@splidejs/splide';

  const initCarousel = () => {
    const splideEl = document.getElementById(id);
    if (!splideEl) return;
    new Splide(splideEl, { type: 'loop', autoplay: true }).mount();
  };

  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initCarousel);
  } else {
    initCarousel();
  }
</script>
